<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit != null && isEdit} ? 'Yazıyı Düzenle - Blog Projesi' : 'Yeni Yazı Yaz - Blog Projesi'">Yeni Yazı Yaz - Blog Projesi</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- Navbar Styles -->
    <div th:replace="~{fragments/navbar-styles :: navbar-styles}"></div>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            color: #2d3748;
            line-height: 1.6;
        }
        
        /* Navbar Styles */
        .navbar {
            background: #ffffff;
            padding: 15px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid #e2e8f0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: #667eea !important;
            display: flex;
            align-items: center;
        }
        
        .navbar-brand i {
            margin-right: 10px;
            font-size: 1.8rem;
        }
        
        .logo-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            margin-right: 10px;
            color: white;
        }
        
        .nav-menu {
            display: flex;
            flex-direction: row;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 5px;
        }
        
        .nav-menu li {
            display: inline-block;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: #667eea;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
        }
        
        .auth-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn-login, .btn-register {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-login {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-login:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-register {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .dropdown-header {
            padding: 12px 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .dropdown-header .user-name {
            font-weight: 600;
            color: #2d3748;
        }
        
        .dropdown-header .user-email {
            font-size: 0.85rem;
            color: #718096;
        }
        
        .dropdown-body {
            padding: 5px 0;
        }
        
        .nav-link {
            color: #4a5568 !important;
            font-weight: 500;
            margin: 0 15px;
            padding: 8px 0 !important;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: #667eea !important;
        }
        
        .nav-link.active {
            color: #667eea !important;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }
        
        .navbar-toggler {
            border: none;
            color: #667eea;
        }
        
        .navbar-toggler:focus {
            box-shadow: none;
        }
        
        /* Profile Dropdown */
        .profile-dropdown {
            position: relative;
        }
        
        .profile-btn {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .profile-btn:hover {
            background-color: #f1f5f9;
            transform: scale(1.05);
        }
        
        .profile-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .dropdown-menu-custom {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: none;
            padding: 10px 0;
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .dropdown-menu-custom.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item-custom {
            padding: 12px 20px;
            color: #4a5568;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .dropdown-item-custom:hover {
            background-color: #f8fafc;
            color: #667eea;
            text-decoration: none;
        }
        
        .dropdown-item-custom i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
        }
        
        .dropdown-divider-custom {
            height: 1px;
            background-color: #e2e8f0;
            margin: 8px 0;
        }
        
        /* Main Content */
        .main-content {
            padding: 100px 0 40px;
            min-height: calc(100vh - 76px);
        }
        
        .editor-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        
        .editor-header {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 30px;
        }
        
        .editor-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-title i {
            color: #667eea;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-outline-secondary {
            border: 2px solid #e2e8f0;
            color: #64748b;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            background: transparent;
            transition: all 0.3s ease;
        }
        
        .btn-outline-secondary:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #475569;
        }
        
        .btn-success {
            background: #10b981;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f7fafc;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background-color: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .title-input {
            font-size: 1.5rem;
            font-weight: 600;
            padding: 20px;
            border: none;
            border-bottom: 2px solid #e2e8f0;
            border-radius: 0;
            background: white;
        }
        
        .title-input:focus {
            border-color: #667eea;
            box-shadow: none;
        }
        
        .title-input::placeholder {
            color: #cbd5e1;
        }
        
        /* Editor Layout */
        .editor-layout {
            display: flex;
            min-height: 600px;
        }
        
        .editor-sidebar {
            width: 300px;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            padding: 30px;
        }
        
        .editor-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        .editor-tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .editor-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }
        
        .editor-tab:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .editor-content {
            flex: 1;
            display: flex;
        }
        
        .editor-pane {
            flex: 1;
            display: none;
        }
        
        .editor-pane.active {
            display: block;
        }
        
        .editor-textarea {
            width: 100%;
            height: 100%;
            border: none;
            padding: 30px;
            font-family: 'Fira Code', 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            background: white;
        }
        
        .editor-textarea:focus {
            outline: none;
        }
        
        .preview-pane {
            padding: 30px;
            background: white;
            overflow-y: auto;
            border-left: 1px solid #e2e8f0;
        }
        
        /* Sidebar Sections */
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sidebar-title i {
            color: #667eea;
        }
        
        /* Post Type Selection */
        .post-type-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .post-type-btn {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .post-type-btn:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .post-type-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .post-type-btn i {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .post-type-btn span {
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .category-item {
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .category-item:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .category-item.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            min-height: 50px;
        }
        
        .tag-item {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tag-remove {
            cursor: pointer;
            font-size: 0.75rem;
            opacity: 0.8;
        }
        
        .tag-remove:hover {
            opacity: 1;
        }
        
        .tag-input input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 120px;
            font-size: 0.9rem;
        }
        
        .publish-options {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-switch .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
        
        /* Draft Status */
        .draft-status {
            background: #fef3c7;
            color: #d97706;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .draft-status.saved {
            background: #d1fae5;
            color: #065f46;
        }
        
        /* Toolbar */
        .editor-toolbar {
            padding: 15px 30px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #64748b;
        }
        
        .toolbar-btn:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .toolbar-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        /* Link Input Section */
        .link-input-section {
            display: none;
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .link-input-section.active {
            display: block;
        }
        
        .link-input-section .form-control {
            background: white;
        }
        
        /* Image Input Section */
        .image-input-section {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .image-preview {
            margin-top: 15px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Preview Styles */
        .preview-content h1,
        .preview-content h2,
        .preview-content h3,
        .preview-content h4,
        .preview-content h5,
        .preview-content h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        
        .preview-content h1 { font-size: 2rem; }
        .preview-content h2 { font-size: 1.5rem; }
        .preview-content h3 { font-size: 1.25rem; }
        
        .preview-content p {
            margin-bottom: 16px;
            line-height: 1.7;
        }
        
        .preview-content blockquote {
            padding: 16px;
            background: #f8fafc;
            border-left: 4px solid #667eea;
            margin: 16px 0;
            font-style: italic;
        }
        
        .preview-content pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
        }
        
        .preview-content code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .preview-content pre code {
            background: none;
            padding: 0;
        }
        
        /* Word Count */
        .word-count {
            color: #64748b;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        /* Alerts */
        .alert-custom {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-danger {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .alert-success {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .editor-layout {
                flex-direction: column;
            }
            
            .editor-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .editor-header {
                padding: 15px 20px;
            }
            
            .editor-toolbar {
                padding: 10px 20px;
            }
            
            .editor-textarea, .preview-pane {
                padding: 20px;
            }
            
            .editor-sidebar {
                padding: 20px;
            }
            
            .category-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .post-type-selection {
                flex-direction: column;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .editor-container {
            animation: slideInUp 0.6s ease forwards;
        }
        
        .notification {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <!-- Navbar -->
    <div th:replace="~{fragments/navbar :: navbar(activePage='write')}"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid">
            <!-- Not authenticated warning -->
            <div th:unless="${isAuthenticated}" class="alert alert-custom alert-danger mb-4">
                <i class="fas fa-exclamation-circle"></i>
                <span>Yazı paylaşmak için <a th:href="@{/login}" class="fw-bold">giriş yapmalısınız</a>.</span>
            </div>
            
            <!-- Error/Success Messages -->
            <div th:if="${error}" class="alert alert-custom alert-danger mb-4">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}">Hata mesajı</span>
            </div>
            <div th:if="${message}" class="alert alert-custom alert-success mb-4">
                <i class="fas fa-check-circle"></i>
                <span th:text="${message}">Başarı mesajı</span>
            </div>
            
            <form th:action="${isEdit != null && isEdit} ? @{'/post/' + ${post.id} + '/edit'} : @{/write}" method="post" id="postForm">
                <div class="editor-container">
                    <!-- Editor Header -->
                    <div class="editor-header">
                        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                            <h1 class="editor-title mb-0">
                                <i class="fas fa-pen-nib"></i>
                                <span th:text="${isEdit != null && isEdit} ? 'Yazıyı Düzenle' : 'Yeni Yazı Yaz'">Yeni Yazı Yaz</span>
                            </h1>
                            <div class="editor-actions">
                                <button type="button" class="btn btn-outline-secondary" onclick="saveDraft()">
                                    <i class="fas fa-save me-1"></i>Taslak Kaydet
                                </button>
                                <button type="submit" class="btn btn-success" th:disabled="${!isAuthenticated}">
                                    <i class="fas fa-paper-plane me-1"></i>
                                    <span th:text="${isEdit != null && isEdit} ? 'Güncelle' : 'Yayınla'">Yayınla</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Title Input -->
                    <input type="text" class="form-control title-input" name="title" id="postTitle" 
                           placeholder="Yazı başlığınızı girin..." maxlength="200" required
                           th:value="${isEdit != null && isEdit} ? ${post.title} : ''">

                    <!-- Editor Layout -->
                    <div class="editor-layout">
                        <!-- Sidebar -->
                        <div class="editor-sidebar">
                            <!-- Draft Status -->
                            <div class="draft-status" id="draftStatus">
                                <i class="fas fa-clock"></i>
                                <span>Taslak otomatik kaydediliyor...</span>
                            </div>

                            <!-- Post Type Selection -->
                            <div class="sidebar-section">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-file-alt"></i>
                                    Yazı Türü
                                </h4>
                                <div class="post-type-selection">
                                    <div class="post-type-btn active" data-type="TEXT" onclick="selectPostType('TEXT')">
                                        <i class="fas fa-align-left"></i>
                                        <span>Yazı</span>
                                    </div>
                                    <div class="post-type-btn" data-type="LINK" onclick="selectPostType('LINK')">
                                        <i class="fas fa-link"></i>
                                        <span>Link</span>
                                    </div>
                                </div>
                                <input type="hidden" name="postType" id="postType" value="TEXT">
                            </div>

                            <!-- Publish Options -->
                            <div class="sidebar-section">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-cog"></i>
                                    Yayın Ayarları
                                </h4>
                                <div class="publish-options">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" name="commentsEnabled" id="enableComments" 
                                               th:checked="${isEdit != null && isEdit} ? ${post.commentsEnabled} : true">
                                        <label class="form-check-label" for="enableComments">
                                            Yorumlara İzin Ver
                                        </label>
                                    </div>
                                </div>
                                <div class="publish-options">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" name="featured" id="featuredPost"
                                               th:checked="${isEdit != null && isEdit} ? ${post.featured} : false">
                                        <label class="form-check-label" for="featuredPost">
                                            Öne Çıkan Yazı
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Categories -->
                            <div class="sidebar-section">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-folder"></i>
                                    Kategori
                                </h4>
                                <div class="category-grid">
                                    <div class="category-item" th:each="cat : ${categories}" 
                                         th:data-category="${cat}" th:text="${cat}"
                                         th:classappend="${isEdit != null && isEdit && post.category == cat} ? ' selected' : ''"
                                         onclick="selectCategory(this)">Kategori</div>
                                    <!-- Varsayılan kategoriler (eğer backend'den gelmezse) -->
                                    <th:block th:if="${#lists.isEmpty(categories)}">
                                        <div class="category-item" data-category="Teknoloji" onclick="selectCategory(this)">Teknoloji</div>
                                        <div class="category-item" data-category="Yazılım" onclick="selectCategory(this)">Yazılım</div>
                                        <div class="category-item" data-category="Web" onclick="selectCategory(this)">Web</div>
                                        <div class="category-item" data-category="Mobil" onclick="selectCategory(this)">Mobil</div>
                                        <div class="category-item" data-category="Yapay Zeka" onclick="selectCategory(this)">Yapay Zeka</div>
                                        <div class="category-item" data-category="Blockchain" onclick="selectCategory(this)">Blockchain</div>
                                        <div class="category-item" data-category="Tasarım" onclick="selectCategory(this)">Tasarım</div>
                                        <div class="category-item" data-category="Kişisel" onclick="selectCategory(this)">Kişisel</div>
                                    </th:block>
                                </div>
                                <!-- Custom Category Input -->
                                <div class="custom-category-section mt-3">
                                    <label class="form-label" style="font-size: 0.85rem; font-weight: 600; color: #4a5568; margin-bottom: 8px;">
                                        <i class="fas fa-plus-circle" style="color: #667eea;"></i> Yeni Kategori Ekle
                                    </label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="customCategoryInput" 
                                               placeholder="Kategori adını yazın ve Enter'a basın..." 
                                               style="border-radius: 10px 0 0 10px; border: 2px solid #e2e8f0; font-size: 0.9rem; padding: 10px 14px;">
                                        <button type="button" class="btn btn-primary" onclick="addCustomCategory()" 
                                                style="border-radius: 0 10px 10px 0; padding: 10px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                                            <i class="fas fa-plus"></i> Ekle
                                        </button>
                                    </div>
                                    <small class="text-muted mt-2 d-block" style="font-size: 0.8rem;">
                                        <i class="fas fa-info-circle"></i> Yukarıdakilerden birini seçin veya kendi kategorinizi yazın
                                    </small>
                                </div>
                                <input type="hidden" name="category" id="selectedCategory" 
                                       th:value="${isEdit != null && isEdit} ? ${post.category} : ''">
                            </div>

                            <!-- Word Count -->
                            <div class="sidebar-section">
                                <h4 class="sidebar-title">
                                    <i class="fas fa-chart-bar"></i>
                                    İstatistikler
                                </h4>
                                <div class="word-count">
                                    Kelime: <span id="wordCount">0</span><br>
                                    Karakter: <span id="charCount">0</span><br>
                                    Okuma Süresi: <span id="readTime">0 dk</span>
                                </div>
                            </div>
                        </div>

                        <!-- Main Editor -->
                        <div class="editor-main">
                            <!-- Link Input Section (for LINK type) -->
                            <div class="link-input-section" id="linkInputSection">
                                <div class="form-group mb-0">
                                    <label class="form-label">
                                        <i class="fas fa-link me-1"></i>Link URL
                                    </label>
                                    <input type="url" class="form-control" name="url" id="linkUrl" 
                                           placeholder="https://example.com"
                                           th:value="${isEdit != null && isEdit} ? ${post.url} : ''">
                                </div>
                            </div>
                            
                            <!-- Image Input Section -->
                            <div class="image-input-section">
                                <div class="form-group mb-0">
                                    <label class="form-label">
                                        <i class="fas fa-image me-1"></i>Kapak Fotoğrafı URL (Opsiyonel)
                                    </label>
                                    <input type="url" class="form-control" name="imageUrl" id="imageUrl" 
                                           placeholder="https://example.com/image.jpg"
                                           th:value="${isEdit != null && isEdit} ? ${post.imageUrl} : ''"
                                           oninput="previewImage()">
                                    <div class="image-preview" id="imagePreview"></div>
                                </div>
                            </div>

                            <!-- Toolbar -->
                            <div class="editor-toolbar" id="textToolbar">
                                <button type="button" class="toolbar-btn" onclick="insertText('**', '**')" title="Kalın">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertText('*', '*')" title="İtalik">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertText('# ', '')" title="Başlık">
                                    <i class="fas fa-heading"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertText('> ', '')" title="Alıntı">
                                    <i class="fas fa-quote-left"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertCodeBlock()" title="Kod Bloku">
                                    <i class="fas fa-code"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertText('- ', '')" title="Liste">
                                    <i class="fas fa-list-ul"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertLink()" title="Link">
                                    <i class="fas fa-link"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertImage()" title="Resim">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button type="button" class="toolbar-btn" onclick="insertText('---\n', '')" title="Yatay Çizgi">
                                    <i class="fas fa-minus"></i>
                                </button>
                            </div>

                            <!-- Editor Tabs -->
                            <div class="editor-tabs" id="editorTabs">
                                <button type="button" class="editor-tab active" onclick="switchTab('write')">
                                    <i class="fas fa-pen me-1"></i>Yaz
                                </button>
                                <button type="button" class="editor-tab" onclick="switchTab('preview')">
                                    <i class="fas fa-eye me-1"></i>Önizleme
                                </button>
                            </div>

                            <!-- Editor Content -->
                            <div class="editor-content">
                                <div class="editor-pane active" id="writePane">
                                    <textarea class="editor-textarea" name="content" id="postContent" 
                                              placeholder="Yazınızı buraya yazın... Markdown desteği mevcuttur.

Örnek kullanım:
# Başlık 1
## Başlık 2

**Kalın metin** ve *italik metin*

> Bu bir alıntıdır

- Liste öğesi 1
- Liste öğesi 2

```javascript
console.log('Kod bloku örneği');
```

[Link metni](http://example.com)

![Resim alt metni](resim-url)" th:text="${isEdit != null && isEdit} ? ${post.content} : ''"></textarea>
                                </div>
                                <div class="editor-pane preview-pane" id="previewPane">
                                    <div class="preview-content" id="previewContent">
                                        <p class="text-muted">Önizleme için yazı yazmaya başlayın...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        let selectedCategory = '';
        let selectedPostType = 'TEXT';
        let isPreviewMode = false;
        let autosaveTimer;
        
        // Profile dropdown functions
        function toggleDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('show');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const profileBtn = document.querySelector('.profile-btn');
            
            if (dropdown && profileBtn && !profileBtn.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners
            setupEventListeners();
            
            // Custom category input için Enter tuşu desteği
            const customCategoryInput = document.getElementById('customCategoryInput');
            if (customCategoryInput) {
                customCategoryInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        console.log('Enter tuşuna basıldı');
                        addCustomCategory();
                    }
                });
            }
            
            // Custom category butonu için click event
            const addCategoryBtn = document.querySelector('.custom-category-section .btn-primary');
            if (addCategoryBtn) {
                addCategoryBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Ekle butonuna tıklandı');
                    addCustomCategory();
                });
            }
            
            // Taslak yükle (edit modunda değilse)
            const isEditMode = document.querySelector('input[name="title"]').value !== '';
            if (!isEditMode) {
                loadDraft();
            }
            
            // Otomatik kaydetmeyi başlat
            startAutosave();
            
            // Mevcut kategori seçimini ayarla (edit mode için)
            const categoryInput = document.getElementById('selectedCategory');
            if (categoryInput.value) {
                selectedCategory = categoryInput.value;
                document.querySelectorAll('.category-item').forEach(item => {
                    if (item.dataset.category === selectedCategory) {
                        item.classList.add('selected');
                    }
                });
            }
            
            // Mevcut post type'ı ayarla (edit mode için)
            const postTypeValue = document.getElementById('postType').value || 'TEXT';
            selectPostType(postTypeValue);
            
            // İlk kelime sayısını güncelle
            updateWordCount();
            
            // Görsel önizleme (edit mode için)
            previewImage();
        });
        
        function setupEventListeners() {
            const titleInput = document.getElementById('postTitle');
            const contentTextarea = document.getElementById('postContent');
            
            // Title ve content değişikliklerini dinle
            if (titleInput) {
                titleInput.addEventListener('input', function() {
                    updatePreview();
                    updateWordCount();
                });
            }
            
            if (contentTextarea) {
                contentTextarea.addEventListener('input', function() {
                    updatePreview();
                    updateWordCount();
                });
            }
        }
        
        function selectPostType(type) {
            selectedPostType = type;
            document.getElementById('postType').value = type;
            
            // Button'ları güncelle
            document.querySelectorAll('.post-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === type) {
                    btn.classList.add('active');
                }
            });
            
            // Link input section'ı göster/gizle
            const linkSection = document.getElementById('linkInputSection');
            const textToolbar = document.getElementById('textToolbar');
            const editorTabs = document.getElementById('editorTabs');
            const writePane = document.getElementById('writePane');
            
            if (type === 'LINK') {
                linkSection.classList.add('active');
                // Link tipi için içerik opsiyonel olabilir, textarea'yı göster ama zorunlu yapma
            } else {
                linkSection.classList.remove('active');
            }
        }
        
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.editor-tab');
            const panes = document.querySelectorAll('.editor-pane');
            
            tabs.forEach(t => t.classList.remove('active'));
            panes.forEach(p => p.classList.remove('active'));
            
            if (tab === 'write') {
                document.querySelector('.editor-tab:first-child').classList.add('active');
                document.getElementById('writePane').classList.add('active');
                isPreviewMode = false;
            } else {
                document.querySelector('.editor-tab:last-child').classList.add('active');
                document.getElementById('previewPane').classList.add('active');
                isPreviewMode = true;
                updatePreview();
            }
        }
        
        function selectCategory(element) {
            // Önceki seçimi temizle
            document.querySelectorAll('.category-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Yeni kategoriyi seç
            element.classList.add('selected');
            selectedCategory = element.dataset.category;
            document.getElementById('selectedCategory').value = selectedCategory;
            
            // Custom input'u temizle
            document.getElementById('customCategoryInput').value = '';
        }
        
        function addCustomCategory() {
            console.log('addCustomCategory fonksiyonu çağrıldı');
            const input = document.getElementById('customCategoryInput');
            const customCategory = input.value.trim();
            
            console.log('Girilen kategori:', customCategory);
            
            if (!customCategory) {
                showNotification('Lütfen bir kategori adı girin', 'error');
                input.focus();
                return;
            }
            
            // Mevcut kategorilerde var mı kontrol et
            const existingItems = document.querySelectorAll('.category-item');
            let categoryExists = false;
            existingItems.forEach(item => {
                // dataset.category undefined olabilir, kontrol et
                if (item.dataset.category && item.dataset.category.toLowerCase() === customCategory.toLowerCase()) {
                    categoryExists = true;
                    selectCategory(item);
                }
            });
            
            if (categoryExists) {
                showNotification('Bu kategori zaten mevcut, seçildi', 'info');
                input.value = '';
                return;
            }
            
            // Yeni kategori oluştur
            const categoryGrid = document.querySelector('.category-grid');
            const newCategoryItem = document.createElement('div');
            newCategoryItem.className = 'category-item';
            newCategoryItem.dataset.category = customCategory;
            newCategoryItem.textContent = customCategory;
            newCategoryItem.onclick = function() { selectCategory(this); };
            
            categoryGrid.appendChild(newCategoryItem);
            
            console.log('Yeni kategori oluşturuldu:', customCategory);
            
            // Yeni kategoriyi otomatik seç
            selectCategory(newCategoryItem);
            
            console.log('selectedCategory değeri:', selectedCategory);
            console.log('Hidden input değeri:', document.getElementById('selectedCategory').value);
            
            // Input'u temizle
            input.value = '';
            
            showNotification('✓ Kategori eklendi ve seçildi: ' + customCategory, 'success');
        }
        
        function insertText(before, after) {
            const textarea = document.getElementById('postContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            const newText = before + selectedText + after;
            textarea.setRangeText(newText, start, end, 'end');
            
            // Focus'u textarea'ya geri ver
            textarea.focus();
            
            // Önizlemeyi güncelle
            updatePreview();
            updateWordCount();
        }
        
        function insertLink() {
            const url = prompt('Link URL girin:', 'https://');
            if (url) {
                const text = prompt('Link metni girin:', 'Link');
                if (text) {
                    const textarea = document.getElementById('postContent');
                    const start = textarea.selectionStart;
                    const linkMarkdown = `[${text}](${url})`;
                    textarea.setRangeText(linkMarkdown, start, start, 'end');
                    textarea.focus();
                    updatePreview();
                    updateWordCount();
                }
            }
        }
        
        function insertImage() {
            const url = prompt('Resim URL girin:', 'https://');
            if (url) {
                const alt = prompt('Resim açıklaması girin:', 'Resim');
                if (alt !== null) {
                    const textarea = document.getElementById('postContent');
                    const start = textarea.selectionStart;
                    const imageMarkdown = `![${alt}](${url})`;
                    textarea.setRangeText(imageMarkdown, start, start, 'end');
                    textarea.focus();
                    updatePreview();
                    updateWordCount();
                }
            }
        }
        
        function insertCodeBlock() {
            const language = prompt('Programlama dili (örn: javascript, python, java):', 'javascript');
            if (language !== null) {
                const textarea = document.getElementById('postContent');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const selectedText = textarea.value.substring(start, end);
                
                const codeBlock = '```' + language + '\n' + (selectedText || 'kod buraya') + '\n```';
                textarea.setRangeText(codeBlock, start, end, 'end');
                textarea.focus();
                updatePreview();
                updateWordCount();
            }
        }
        
        function previewImage() {
            const imageUrl = document.getElementById('imageUrl').value;
            const previewDiv = document.getElementById('imagePreview');
            
            if (imageUrl) {
                previewDiv.innerHTML = `<img src="${imageUrl}" alt="Önizleme" onerror="this.parentElement.innerHTML='<p class=\\'text-muted\\'>Görsel yüklenemedi</p>'">`;
            } else {
                previewDiv.innerHTML = '';
            }
        }
        
        function updatePreview() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const previewContent = document.getElementById('previewContent');
            
            let html = '';
            
            if (title) {
                html += `<h1>${escapeHtml(title)}</h1>`;
            }
            
            if (content) {
                // Configure marked
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: true
                });
                html += marked.parse(content);
            } else {
                html = '<p class="text-muted">Önizleme için yazı yazmaya başlayın...</p>';
            }
            
            previewContent.innerHTML = html;
            
            // Syntax highlighting uygula
            if (window.Prism) {
                Prism.highlightAllUnder(previewContent);
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function updateWordCount() {
            const content = document.getElementById('postContent').value;
            const title = document.getElementById('postTitle').value;
            
            const allText = title + ' ' + content;
            const words = allText.trim().split(/\s+/).filter(word => word.length > 0);
            const wordCount = words.length;
            const charCount = allText.length;
            const readTime = Math.ceil(wordCount / 200); // 200 kelime/dakika ortalama
            
            document.getElementById('wordCount').textContent = wordCount;
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('readTime').textContent = readTime + ' dk';
        }
        
        function saveDraft() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            
            // Başlık kontrolü
            if (!title || title.trim() === '') {
                showToast('Taslak kaydetmek için en az bir başlık girin', 'error');
                return;
            }
            
            // Form verilerini oluştur ve sunucuya gönder
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/draft';
            
            const fields = {
                title: title,
                content: content || '',
                category: selectedCategory || '',
                postType: selectedPostType || 'TEXT',
                url: document.getElementById('linkUrl').value || '',
                imageUrl: document.getElementById('imageUrl').value || ''
            };
            
            for (const [key, value] of Object.entries(fields)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = value;
                form.appendChild(input);
            }
            
            // CSRF token ekle (eğer varsa)
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            if (csrfToken && csrfHeader) {
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = '_csrf';
                csrfInput.value = csrfToken.content;
                form.appendChild(csrfInput);
            }
            
            // Form gönderildiğini işaretle (beforeunload uyarısı için)
            isFormSubmitting = true;
            
            document.body.appendChild(form);
            form.submit();
        }
        
        function saveDraftToLocalStorage() {
            // LocalStorage'a da kaydet (otomatik kaydetme için)
            const postData = {
                title: document.getElementById('postTitle').value,
                content: document.getElementById('postContent').value,
                category: selectedCategory,
                postType: selectedPostType,
                url: document.getElementById('linkUrl').value,
                imageUrl: document.getElementById('imageUrl').value,
                commentsEnabled: document.getElementById('enableComments').checked,
                featuredPost: document.getElementById('featuredPost').checked,
                savedAt: new Date().toISOString(),
                status: 'draft'
            };
            
            localStorage.setItem('blogDraft', JSON.stringify(postData));
            updateDraftStatus('saved');
        }
        
        function loadDraft() {
            const draft = localStorage.getItem('blogDraft');
            if (draft) {
                const postData = JSON.parse(draft);
                
                document.getElementById('postTitle').value = postData.title || '';
                document.getElementById('postContent').value = postData.content || '';
                document.getElementById('enableComments').checked = postData.commentsEnabled !== false;
                document.getElementById('featuredPost').checked = postData.featuredPost || false;
                document.getElementById('linkUrl').value = postData.url || '';
                document.getElementById('imageUrl').value = postData.imageUrl || '';
                
                if (postData.category) {
                    selectedCategory = postData.category;
                    document.getElementById('selectedCategory').value = selectedCategory;
                    document.querySelectorAll('.category-item').forEach(item => {
                        if (item.dataset.category === selectedCategory) {
                            item.classList.add('selected');
                        }
                    });
                }
                
                if (postData.postType) {
                    selectPostType(postData.postType);
                }
                
                updateWordCount();
                updatePreview();
                previewImage();
                updateDraftStatus('saved');
            }
        }
        
        function startAutosave() {
            autosaveTimer = setInterval(() => {
                const title = document.getElementById('postTitle').value;
                const content = document.getElementById('postContent').value;
                
                if (title.trim() || content.trim()) {
                    // Sadece local storage'a kaydet, sunucuya göndermeden
                    const postData = {
                        title: title,
                        content: content,
                        category: selectedCategory,
                        postType: selectedPostType,
                        url: document.getElementById('linkUrl').value,
                        imageUrl: document.getElementById('imageUrl').value,
                        commentsEnabled: document.getElementById('enableComments').checked,
                        featuredPost: document.getElementById('featuredPost').checked,
                        savedAt: new Date().toISOString(),
                        status: 'draft'
                    };
                    localStorage.setItem('blogDraft', JSON.stringify(postData));
                    updateDraftStatus('saved');
                }
            }, 30000); // 30 saniyede bir otomatik kaydet
        }
        
        function updateDraftStatus(status) {
            const statusElement = document.getElementById('draftStatus');
            const now = new Date().toLocaleTimeString('tr-TR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (status === 'saved') {
                statusElement.className = 'draft-status saved';
                statusElement.innerHTML = `
                    <i class="fas fa-check"></i>
                    <span>Taslak kaydedildi (${now})</span>
                `;
            } else {
                statusElement.className = 'draft-status';
                statusElement.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <span>Taslak otomatik kaydediliyor...</span>
                `;
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            let alertClass = 'alert-info';
            let iconClass = 'info-circle';
            
            if (type === 'success') {
                alertClass = 'alert-success';
                iconClass = 'check-circle';
            } else if (type === 'error') {
                alertClass = 'alert-danger';
                iconClass = 'exclamation-circle';
            }
            
            notification.className = `alert ${alertClass} position-fixed notification`;
            notification.style.cssText = `
                top: 100px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                border: none;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            `;
            notification.innerHTML = `
                <i class="fas fa-${iconClass} me-2"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // Form submit öncesi kontrol
        document.getElementById('postForm').addEventListener('submit', function(e) {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            const postType = selectedPostType;
            const linkUrl = document.getElementById('linkUrl').value.trim();
            
            if (!title) {
                e.preventDefault();
                showNotification('Lütfen yazı başlığı girin!', 'error');
                return;
            }
            
            if (postType === 'TEXT' && !content) {
                e.preventDefault();
                showNotification('Lütfen yazı içeriği girin!', 'error');
                return;
            }
            
            if (postType === 'LINK' && !linkUrl) {
                e.preventDefault();
                showNotification('Lütfen link URL girin!', 'error');
                return;
            }
            
            if (!selectedCategory) {
                e.preventDefault();
                showNotification('Lütfen bir kategori seçin!', 'error');
                return;
            }
            
            // Form gönderildiğinde taslağı temizle ve flag ayarla
            localStorage.removeItem('blogDraft');
            isFormSubmitting = true;
        });
        
        // Form gönderimi flag'i
        let isFormSubmitting = false;
        
        // Sayfa kapatma uyarısı
        window.addEventListener('beforeunload', function(e) {
            // Form gönderiliyorsa uyarı verme
            if (isFormSubmitting) {
                return;
            }
            
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            
            if (title || content) {
                e.preventDefault();
                e.returnValue = 'Kaydedilmemiş değişiklikleriniz var. Sayfayı kapatmak istediğinizden emin misiniz?';
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveDraft();
                        break;
                    case 'b':
                        e.preventDefault();
                        insertText('**', '**');
                        break;
                    case 'i':
                        e.preventDefault();
                        insertText('*', '*');
                        break;
                    case 'k':
                        e.preventDefault();
                        insertLink();
                        break;
                }
            }
        });
    </script>
</body>
</html>
